# Dockerfile for CepApi.Domain class libraries

# Use the .NET SDK image for building
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR ./

# Copy the project files and restore dependencies
COPY CepApi.Domain/*.csproj CepApi.Domain/
COPY CepApi.Domain.Infra/*.csproj CepApi.Domain.Infra/
COPY CepApi.Domain.Shared/*.csproj CepApi.Domain.Shared/
RUN dotnet restore CepApi.Domain

# Copy the remaining source code
COPY . .

# Build the application
RUN dotnet build -c Release --no-restore

# Output artifacts
FROM build AS publish
RUN dotnet publish -c Release -o /app --no-restore

# Final image
FROM mcr.microsoft.com/dotnet/aspnet:8.0
WORKDIR /app
COPY --from=publish /app .

ENTRYPOINT ["dotnet", "CepApi.Domain.Api.dll"]